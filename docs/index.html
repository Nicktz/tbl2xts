<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Convert Tibbles or Data Frames to Xts Easily • tbl2xts</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Convert Tibbles or Data Frames to Xts Easily">
<meta property="og:description" content="Facilitate the movement between data frames to xts. Particularly
    useful when moving from tidyverse to the widely used xts package, which is
    the input format of choice to various other packages. It also allows the user 
    to use a spread_by argument for a character column xts conversion.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">tbl2xts</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/tbl2xts_vignette.html">Moving From Tbl To Xts Easily</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/nicktz/tbl2xts/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<div id="tbl2xts" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#tbl2xts" class="anchor"></a>tbl2xts</h1></div>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>This package helps users who want to put data.frame or tbl_df objects into xts format easily. Xts is a powerful package used to convert data frames into time-series. This package is widely used in other packages in R too.</p>
<p>The problem is that often times users want to move from a tbl format, or a tidyverse format, into xts, but doing so can be an onerous task. This package aims to overcome this problem by bridging the tbl_df or data.table to xts gap. It also allows the user to use a spread_by argument for an easy character column xts conversion for tidy data.</p>
</div>
</div>
<div id="examples" class="section level1">
<h1 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h1>
<p>To illustrate the ease with which tbl2xts transforms data.frames or tbl_dfs into xts format, consider the following examples.</p>
<div id="example-1" class="section level2">
<h2 class="hasAnchor">
<a href="#example-1" class="anchor"></a>Example 1</h2>
<p>Transform a dataframe into xts format:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">library</span>(tbl2xts)</span>
<span id="cb1-3"><a href="#cb1-3"></a>tbl2xts<span class="op">::</span>TRI <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw">tbl_xts</span>(., <span class="dt">cols_to_xts =</span> <span class="kw">c</span>(TRI, Return), <span class="dt">spread_by =</span> Country)</span></code></pre></div>
<p>Notice as of version 1.0.0 of this package, inputs are now quo_sures ~ so you don’t have to use quotations for parameters.</p>
</div>
<div id="note" class="section level2">
<h2 class="hasAnchor">
<a href="#note" class="anchor"></a>Note</h2>
<p>The input data frame requires a valid date column (similar to the requirement for the xts package). The function will check if a column <em>date</em>, <em>DATE</em>, or <em>Date</em> exists, or alternatively look for a valid timeBased object in your worfkile and rename it Date. This column can be either a Date, POSIXct, chron, yearmon, yearqtr or timeDate (see ?timeBased) column. The validity of the date column can be tested using:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">data</span>(TRI)</span>
<span id="cb2-2"><a href="#cb2-2"></a>TRI[,<span class="st">"Date"</span>] <span class="op">%&gt;%</span><span class="st"> </span>.[[<span class="dv">1</span>]] <span class="op">%&gt;%</span><span class="st"> </span>xts<span class="op">::</span><span class="kw">timeBased</span>()</span></code></pre></div>
<p>If TRUE, it is a valid date column.</p>
</div>
<div id="example-2" class="section level2">
<h2 class="hasAnchor">
<a href="#example-2" class="anchor"></a>Example 2</h2>
<p>We could also add a suffix or prefix to the column name created. In the example below, adding spread_name_pos = “Suffix” makes columns <country>_TRI.</country></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>tbl2xts<span class="op">::</span>TRI <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tbl_xts</span>(., <span class="dt">cols_to_xts =</span> TRI, <span class="dt">spread_by =</span> Country, <span class="dt">spread_name_pos =</span> <span class="st">"Suffix"</span>)</span></code></pre></div>
<p>You could also easily transform multiple numeric columns into xts using the spread_by functionality:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>tbl2xts<span class="op">::</span>TRI <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tbl_xts</span>(., <span class="dt">cols_to_xts =</span> <span class="kw">c</span>(TRI, Return), <span class="dt">spread_by =</span> Country)</span></code></pre></div>
<p>Notice for this example, I forced a spread_name_pos = “Suffix” to allow for differentiation as you chose to spread_by and have multiple cols_to_xts.</p>
<p>If you set explicitly set spread_name_pos = “NONE”, you will be warned of the “Suffix” override.</p>
<p>You could also use a vector input for transformation:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>vector_to_xts &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"TRI"</span>, <span class="st">"Return"</span>)</span>
<span id="cb5-2"><a href="#cb5-2"></a>Spread &lt;-<span class="st"> "Country"</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>tbl2xts<span class="op">::</span>TRI <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tbl_xts</span>(., <span class="dt">cols_to_xts =</span> <span class="kw">all_of</span>(vector_to_xts), <span class="dt">spread_by =</span> <span class="kw">all_of</span>(Spread))</span></code></pre></div>
<p>Also notice that xts natively replaces spaces in column names with “.”.</p>
<p>This can be seen e.g. here:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>tbl2xts<span class="op">::</span>TRI <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Country =</span> <span class="kw">paste0</span>(Country, <span class="st">" With Space"</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="kw">tbl_xts</span>(., <span class="dt">cols_to_xts =</span> Return, <span class="dt">spread_by =</span> <span class="kw">all_of</span>(Spread)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">names</span>()</span></code></pre></div>
<p>To avoid the names having spaces (which could cause frustration when gathering later): set Colnames_Exact = TRUE (Note this is set to default, as users generally expect xts to replace spaces with ‘.’).</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>tbl2xts<span class="op">::</span>TRI <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Country =</span> <span class="kw">paste0</span>(Country, <span class="st">" With Space"</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="kw">tbl_xts</span>(., <span class="dt">cols_to_xts =</span> Return, <span class="dt">spread_by =</span> <span class="kw">all_of</span>(Spread), <span class="dt">Colnames_Exact =</span> <span class="ot">TRUE</span>)  <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">names</span>()</span></code></pre></div>
<div id="to-now-transform-the-xts-object-back-into-a-tbl_df-object-simply-use-the-inverse-command" class="section level3">
<h3 class="hasAnchor">
<a href="#to-now-transform-the-xts-object-back-into-a-tbl_df-object-simply-use-the-inverse-command" class="anchor"></a>To now transform the xts object back into a tbl_df() object, simply use the inverse command:</h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>xtsdata &lt;-<span class="st"> </span>tbl2xts<span class="op">::</span>TRI <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tbl_xts</span>(., <span class="dt">cols_to_xts =</span> TRI, <span class="dt">spread_by =</span> Country, <span class="dt">spread_name_pos =</span> <span class="st">"Suffix"</span>)</span>
<span id="cb8-2"><a href="#cb8-2"></a>xtsdata <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">xts_tbl</span>()</span></code></pre></div>
</div>
</div>
<div id="example-3-using-downstream-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#example-3-using-downstream-packages" class="anchor"></a>Example 3: using downstream packages</h2>
<p>tbl_xts also facilitates the use of tbl_df data frames in packages that use xts. As an illustration, see the output for TRI with the package PerformanceAnalytics. As we are working with Total Return Index values, suppose we wanted to calculate the weekly returns, and then the … using PerformanceAnalytics. This can now be achieved with neat code as follows:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="kw">library</span>(tbl2xts)</span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="kw">library</span>(PerformanceAnalytics)</span>
<span id="cb9-4"><a href="#cb9-4"></a>tbl2xts<span class="op">::</span>TRI <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tbl_xts</span>(., <span class="dt">cols_to_xts =</span> TRI, <span class="dt">spread_by =</span> Country) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb9-5"><a href="#cb9-5"></a>PerformanceAnalytics<span class="op">::</span><span class="kw">Return.calculate</span>(., <span class="st">"discrete"</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb9-6"><a href="#cb9-6"></a>PerformanceAnalytics<span class="op">::</span><span class="kw">Return.cumulative</span>(.)</span></code></pre></div>
</div>
<div id="example-4" class="section level2">
<h2 class="hasAnchor">
<a href="#example-4" class="anchor"></a>Example 4</h2>
<p>Here I show how you can easily do quite advanced calculations and seemlessly move from tbl to xts back to tbl. Below I use xts’ apply.yearly and PerformanceAnalytics’ suite of calculations that allow us to do some nice analytics easily:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>tbl2xts<span class="op">::</span>TRI <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tbl_xts</span>(., <span class="dt">cols_to_xts =</span> TRI, <span class="dt">spread_by =</span> Country) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb10-2"><a href="#cb10-2"></a>PerformanceAnalytics<span class="op">::</span><span class="kw">Return.calculate</span>(.) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb10-3"><a href="#cb10-3"></a>xts<span class="op">::</span><span class="kw">apply.yearly</span>(., <span class="dt">FUN =</span> PerformanceAnalytics<span class="op">::</span>StdDev.annualized) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb10-4"><a href="#cb10-4"></a>xts_tbl <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Year =</span> <span class="kw">format</span>(date, <span class="st">"%Y"</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(Year, <span class="kw">everything</span>(), <span class="op">-</span>date)</span></code></pre></div>
<p>Note how easy we could do quite advanced calculations in a single pipe. E.g. if tasked with producing a plot for the annual CVaR numbers for our countries:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="kw">library</span>(tidyr)</span>
<span id="cb11-3"><a href="#cb11-3"></a>TRI <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tbl_xts</span>(., <span class="dt">cols_to_xts =</span> TRI, <span class="dt">spread_by =</span> Country) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb11-4"><a href="#cb11-4"></a>PerformanceAnalytics<span class="op">::</span><span class="kw">Return.calculate</span>(.) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-5"><a href="#cb11-5"></a>xts<span class="op">::</span><span class="kw">apply.yearly</span>(., <span class="dt">FUN =</span> PerformanceAnalytics<span class="op">::</span>CVaR) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-6"><a href="#cb11-6"></a>xts_tbl <span class="op">%&gt;%</span><span class="st"> </span>tidyr<span class="op">::</span><span class="kw">gather</span>(Country, CVaR, <span class="op">-</span>date) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(date, CVaR)) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span><span class="kw">facet_wrap</span>(<span class="op">~</span>Country)</span></code></pre></div>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=tbl2xts">https://​cloud.r-project.org/​package=tbl2xts</a>
</li>
<li>Browse source code at <br><a href="https://github.com/nicktz/tbl2xts/">https://​github.com/​nicktz/​tbl2xts/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/nicktz/tbl2xts/issues">https://​github.com/​nicktz/​tbl2xts/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Nico Katzke <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p>Developed by Nico Katzke.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
